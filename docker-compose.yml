services:
    dynamicDataCollectorService:
        build: 
            context: ./FractalDynamicDataCollector
            dockerfile: DockerfileDeployNginx
        command: python /srv/flask_app/apis/http/api/endpoints.py
        image: jperdek/dynamic-data-collector
        ports:
            - "5000:5000"
        extra_hosts:
            - "hostname1  localhost:127.0.0.1"
        container_name: dynamicDataCollector
        volumes:
            - source-volume:/EvolutionSPLFramework/splsToMerge
            - evolution-volume:/evolution
        env_file: .env
        environment:
            FLASK_ENV: development
        networks:
            - buildernet
    fullyAutomatedEvolutionFramework:
        build:
            context: ./EvolutionSPLFramework
            dockerfile: Dockerfile
        image: jperdek/fully-automated-evolution
        ports:
            - "5002:5002"
        container_name: fully-automated-evolution
        volumes:
            - source-volume:/EvolutionSPLFramework/splsToMerge
            - evolution-volume:/evolution
        env_file: .env
        environment:
            FLASK_ENV: development
            IS_LINUX: true,
            PROJECT_PATH: ${PROJECT_PATH:-/EvolutionSPLFramework}
            PATH_TO_EVOLUTION_DIRECTORY: ${PATH_TO_EVOLUTION_DIRECTORY:-/evolution}
            CANTO_SCRIPT_RESOURCE_LOCATION: ${CANTO_SCRIPT_RESOURCE_LOCATION:-/EvolutionSPLFramework/resources/canto/canto-0.15.js}
        networks:
            - buildernet
    astConverterAndComplexityAnalysisAPI:
        image: jperdek/ast-converter-and-complexity-analysis-api
        build:
            context: ./ConverterAndComplexityAnalyzerAPI
            dockerfile: Dockerfile
        ports:
            - "5001:5001"
        extra_hosts:
            - "hostname1  localhost:127.0.0.1"
        networks:
        - buildernet
        restart: on-failure
    fractalKnowledgeBase: 
        build:
            context: ./SemanticBaseNeo4j/fractalKnowledgeBase
            dockerfile: Dockerfile
        image: jperdek/fractal-knowledge-base
        hostname: neo4j
        container_name: neo4j
        ports:
            - "7475:7475"
            - "7688:7688"
        volumes:
            - ./neo4j/plugins:/plugins
        env_file: .env
        environment:
            NEO4J_AUTH: ${KNOWLEDGE_BASE_USERNAME:-neo4j}/${KNOWLEDGE_BASE_PASSWORD:-featureNeo4}
            NEO4J_dbms_logs_debug_level: ${KNOWLEDGE_BASE_LOG_LEVEL:-DEBUG}
    splsToProcessMessageQueue:
        env_file: .env
        image: rabbitmq:4.0-management-alpine
        environment:
            RABBITMQ_DEFAULT_USER: ${PROCESSING_QUEUE_USERNAME:-splManager}
            RABBITMQ_DEFAULT_PASS: ${PROCESSING_QUEUE_PASSWORD:-splManager}
            RABBITMQ_DEFAULT_VHOST: ${PROCESSING_QUEUE_VHOST:-/evolution}
        ports:
            - 15672:15672
        volumes:
            - rabbitmq-volume:/var/lib/rabbitmq/
        networks:
            - buildernet
volumes:
    source-volume:
    evolution-volume:
    dataset-products-volume:
    rabbitmq-volume:
networks:
    buildernet:
        driver: "bridge"
    